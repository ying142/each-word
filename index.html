<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>èŠ±ç“£å­—ã€Œå„ã€å­—æ—ï½œå­¸ç¿’éŠæˆ²</title>
  <style>
    :root{
      --bg:#fbf6f6; /* æ·ºç²‰è‰²åº• */
      --c1:#fce6e6; /* æš–ç²‰ */
      --c2:#e6fcfc; /* æ·ºé’ */
      --c3:#f6e6fc; /* æ·ºç´« */
      --c4:#fcfce6; /* æ·ºé»ƒ */
      --txt:#333;
      --accent:#ff7aa2;
      --accent2:#6cc4ff;
      --good:#64b971; /* æ–°çš„ç¶ è‰² */
      --bad:#e27b7b; /* æ–°çš„ç´…è‰² */
      --shadow:0 8px 16px rgba(0,0,0,.06);
      --radius:18px;
    }
    html,body{height:100%}
    body{
      margin:0; font-family: "Microsoft JhengHei","Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto;
      color:var(--txt);
      background: radial-gradient(1200px 800px at 20% -10%, var(--c2), transparent 60%),
                  radial-gradient(900px 700px at 120% 0%, var(--c3), transparent 50%),
                  radial-gradient(700px 500px at 0% 110%, var(--c1), transparent 60%),
                  var(--bg);
    }
    header{
      padding:18px 20px 8px; text-align:center;
    }
    h1{
      margin:0; font-size:2.2rem; letter-spacing:.02em;
      color:#5e274b; /* æ·±ç²‰è‰²æ¨™é¡Œ */
    }
    .subtitle{margin-top:6px; color:#855e7a; font-size:1.05rem}
    .container{
      max-width:1100px; margin:14px auto 40px; padding:0 16px;
    }
    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center; margin:14px 0 8px;
    }
    .pill{
      background:white; border-radius:999px; padding:10px 14px; box-shadow:var(--shadow);
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .btn{
      appearance:none; border:none; border-radius:12px; padding:10px 14px;
      background:linear-gradient(180deg, #fff, #f6f6f6); box-shadow:var(--shadow);
      cursor:pointer; font-size:1rem;
      transition:transform 0.1s ease, box-shadow 0.1s ease;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 20px rgba(0,0,0,.1);
    }
    .btn.primary{background:linear-gradient(180deg, #ffdeee, #ffd2e1); color:#7c1641; font-weight:700}
    .btn.accent{background:linear-gradient(180deg, #d9f1ff, #c7e9ff); color:#0b5680; font-weight:700}
    .btn.good{background:linear-gradient(180deg, #d4ffd4, #b9ffb9); color:#1c813a; font-weight:700}
    .btn.bad{background:linear-gradient(180deg, #ffdede, #ffc9c9); color:#a82020; font-weight:700}
    .tabs{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:12px 0 18px}
    .tab{padding:10px 14px; border-radius:999px; background:white; box-shadow:var(--shadow); cursor:pointer; font-weight:700; transition:all .2s;}
    .tab.active{background:linear-gradient(180deg,#fff,#ffeef5); border:2px solid var(--accent); color:#7c1641; transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.15);}
    .tab:hover:not(.active){transform:translateY(-1px);}
    .panel{display:none}
    .panel.active{display:block}

    .card{
      background:white; border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px; margin-bottom:18px;
    }
    .card-title{
      font-size:1.3rem; font-weight:800; display:flex; align-items:center; gap:12px;
      color:#5e274b;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px dashed #f0f0f0;
    }
    .card-g1 {background-color: var(--c2);} /* æ·ºé’è‰²çµ¦é—œå¡ä¸€ */
    .card-g2 {background-color: var(--c4);} /* æ·ºé»ƒè‰²çµ¦é—œå¡äºŒ */
    .card-g3 {background-color: var(--c1);} /* æš–ç²‰è‰²çµ¦é—œå¡ä¸‰ */
    .card-g4 {background-color: var(--c3);} /* æ·ºç´«è‰²çµ¦é—œå¡å›› */
    
    .inst{font-size:1.05rem; color:#444; margin:10px 0 6px; line-height:1.6}
    .big{font-size:1.8rem}
    .xl{font-size:2.6rem}
    .grid{
      display:grid; gap:14px;
    }
    @media (min-width:800px){
      .grid.cols-2{grid-template-columns:1fr 1fr;}
      .grid.cols-3{grid-template-columns:repeat(3,1fr);}
      .grid.cols-4{grid-template-columns:repeat(4,1fr);}
    }
    .option{
      background:linear-gradient(180deg, #fff, #f9f9f9); border-radius:16px; padding:16px;
      text-align:center; cursor:pointer; border:2px solid transparent; transition:.15s;
      min-height:90px; display:flex; flex-direction:column; justify-content:center; gap:6px;
      box-shadow: 0 4px 8px rgba(0,0,0,.08);
    }
    .option:hover{transform:translateY(-2px); box-shadow:0 8px 16px rgba(0,0,0,.12);}
    .option.correct{border-color:var(--good); background:var(--c4);}
    .option.wrong{border-color:var(--bad); background:#ffe7e7;}
    .han{font-size:2.2rem; font-weight:900}
    .bpmf{font-size:1.1rem; color:#666}
    .def{font-size:1rem; color:#555}

    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    .draggable{
      display:inline-flex; align-items:center; justify-content:center;
      width:72px; height:72px; border-radius:16px; background:#fff; box-shadow:var(--shadow); cursor:pointer;
      font-size:2.2rem; font-weight:900; border:2px dashed #eee; user-select:none;
      transition:transform 0.1s ease;
      position: relative;
    }
    .draggable:hover{transform:scale(1.05);}
    .draggable:active{transform:scale(0.95);}
    .draggable.selected{
      border-color: var(--accent);
      background: linear-gradient(180deg, #fff, #ffeef5);
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(255, 122, 162, 0.3);
    }
    .dropzone{
      min-width:72px; min-height:72px; border-radius:16px; border:3px dashed #bbb; background:#fafafa;
      display:inline-flex; align-items:center; justify-content:center; font-size:2rem; font-weight:900; padding:6px 10px;
      cursor:pointer; transition:all 0.2s ease;
    }
    .dropzone:hover{
      border-color: var(--accent);
      background: #f8f8ff;
    }
    .dropzone.ok{border-color:var(--good); background:#e6f9e6;}
    .dropzone.no{border-color:var(--bad); background:#f9e6e6;}
    .dropzone.highlighted{
      border-color: var(--accent);
      background: linear-gradient(180deg, #fff, #ffeef5);
      transform: scale(1.05);
    }
    
    /* G2 new styles */
    .g2-grid-container {
      display: grid;
      grid-template-columns: 1fr 200px 1fr; /* ä¸‰æ¬„ä½ˆå±€ï¼Œä¸­é–“æ‹–æ›³å€å›ºå®šå¯¬åº¦ */
      gap: 20px;
    }
    .g2-drag-pool {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 10px;
      border-radius: var(--radius);
      background: white; /* æ‹–æ›³å€èƒŒæ™¯ç¶­æŒç™½è‰² */
      box-shadow: inset 0 0 8px rgba(0,0,0,.1);
    }
    .g2-board-card {
      background: var(--c2); /* å·¦å³å¡«ç©ºå€èƒŒæ™¯ */
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .g2-drag-pool .draggable {
      width: 100%;
      height: 72px;
      border: none;
      background: #fff;
    }
    .g2-board {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    @media (max-width: 800px) {
      .g2-grid-container {
        grid-template-columns: 1fr; /* å°è¢å¹•æ”¹ç‚ºå–®æ¬„ */
      }
      .g2-drag-pool {
        flex-direction: row; /* å°è¢å¹•æ‹–æ›³å€æ”¹ç‚ºæ©«å‘ */
        flex-wrap: wrap;
        width: 100%;
        padding: 10px 14px;
        order: -1; /* å°è¢å¹•ä¸‹å°‡å­—å¡å€ç§»åˆ°æœ€ä¸Šé¢ */
      }
      .g2-drag-pool .draggable {
        width: 72px;
        height: 72px;
      }
    }
    .hint-text {
      font-size: 0.9rem;
      color: #777;
      margin-top: 8px;
    }

    /* é—œå¡ä¸‰æ–°æ¨£å¼ */
    .g3-grid-container {
      /* èª¿æ•´å…©æ¬„å¯¬åº¦ä¸¦å¢åŠ é–“è· */
      display: grid;
      grid-template-columns: minmax(180px, 220px) 1fr;
      gap: 40px; /* å¢åŠ å…©æ¬„ä¹‹é–“çš„é–“è· */
    }
    @media (max-width: 800px) {
      .g3-grid-container {
        grid-template-columns: 1fr; /* å°è¢å¹•æ”¹ç‚ºå–®æ¬„ */
      }
    }
    .word-chip-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .word-chip{
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      background: #fff;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      text-align: center;
      height: 60px; /* å›ºå®šé«˜åº¦ï¼Œè®“å¡ç‰‡å¤§å°ä¸€è‡´ */
      cursor: pointer;
      transition: all 0.15s ease;
      user-select: none;
    }
    .word-chip:hover{
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,.12);
    }
    .word-chip:active{transform: translateY(0); box-shadow: 0 4px 8px rgba(0,0,0,.08);}
    .word-chip.selected{
      border: 3px solid var(--accent);
      background: linear-gradient(180deg, #fff, #ffeef5);
      transform: translateY(-2px) scale(1.02);
    }

    /* é—œå¡å››æ–°æ¨£å¼ */
    .g4-grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr; /* å…©æ¬„ä½ˆå±€ */
      gap: 20px;
    }
    @media (max-width: 800px) {
      .g4-grid-container {
        grid-template-columns: 1fr; /* å°è¢å¹•æ”¹ç‚ºå–®æ¬„ */
      }
    }
    .g4-line {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-size: 1.6rem; /* åŠ å¤§å­—é«” */
      font-weight: 700;
      line-height: 1.5;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 12px; /* å¢åŠ è¡Œé–“è· */
    }
    .g4-line:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.1);
    }
    .g4-line.active {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
      border: 3px solid #7c1641;
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.02); }
    }
    .g4-line-icon {
      font-size: 2.2rem;
    }
    .g4-line.c1 { background-color: var(--c1); }
    .g4-line.c2 { background-color: var(--c2); }
    .g4-line.c3 { background-color: var(--c3); }
    .g4-line.c4 { background-color: var(--c4); }


    .line{padding:10px 14px; border-radius:12px; background:#fff; box-shadow:var(--shadow); font-size:1.3rem; line-height:1.8}
    .line.active{background:linear-gradient(180deg,#fff,#fef6ff); border:2px solid var(--accent)}
    .line.highlighted{
      border-color: var(--accent);
      background: linear-gradient(180deg,#fff,#fef6ff);
      transform: scale(1.02);
    }
    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{background:#fff; padding:6px 10px; border-radius:999px; box-shadow:var(--shadow); font-size:.95rem}
    .score{font-weight:800; color:#1c813a}
    .muted{color:#666}
    .flex-center{display:flex; align-items:center; justify-content:center}
    .equal-sign{font-size:2.5rem; margin:0 8px;}

    .footer-note{font-size:.95rem; color:#666; text-align:center; margin-top:20px}
    .tiny{font-size:.92rem; color:#777}

    /* cute emoji confetti */
    .confetti{
      position:fixed; top:0; left:0; width:100%; height:0; pointer-events:none; overflow:visible;
    }
    .confetti span{
      position:absolute; top:-20px; font-size:24px; animation:fall 1.6s ease-in forwards;
    }
    @keyframes fall{
      100%{transform:translateY(110vh) rotate(720deg); opacity:.2}
    }
  
/* é—œå¡ä¸‰å­—é«”èª¿æ•´ */
#g3 .word-chip {
  font-size: 3em !important; /* å·¦é‚Šè©èªæ”¾å¤§3å€ */
}

#g3 .line {
  font-size: 2em !important; /* å³é‚Šè§£é‡‹æ”¾å¤§2å€ */
}


/* é—œå¡ä¸‰ï¼šè©èªèˆ‡è§£é‡‹å€å¡Šæ¨£å¼èª¿æ•´ */
#g3 .word-chip,
#g3 .line {
  border-radius: 999px !important; /* åœ“è§’å¼§å½¢ */
  height: 70px; /* çµ±ä¸€é«˜åº¦ */
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
}

/* è®“å·¦å³æ¬„ä½å°é½Š */
#g3 .g3-grid-container > div {
  display: flex;
  flex-direction: column;
  gap: 12px;
  justify-content: flex-start;
}
/* é—œå¡ä¸‰ï¼šå·¦å³æ¬„ä½èƒŒæ™¯è‰²å€éš” */
#g3 .g3-grid-container > div:first-child {
  background-color: var(--c2); /* æ·ºé’ï¼šå·¦é‚Šè©èª */
  padding: 12px;
  border-radius: var(--radius);
}

#g3 .g3-grid-container > div:last-child {
  background-color: var(--c4); /* æ·ºé»ƒï¼šå³é‚Šè§£é‡‹ */
  padding: 12px;
  border-radius: var(--radius);
}

</style>
</head>
<body>
  <header>
    <h1>ğŸŒ¸ èŠ±è¾¦å­—ã€Œå„ã€å®¶æ—ï¼šå°å°æ–‡å­—æ¢éšªå®¶</h1>
    <div class="subtitle">é§±ã€æ ¼ã€å®¢ã€é–£ã€çµ¡ã€è³‚ã€é…ªã€æ´›ã€è½ã€è·¯ã€ç•¥ï½œå¤§å­—é«”ï¼å¯æ„›ä»‹é¢ï¼å¯æœ—è®€</div>
  </header>

  <div class="container">
    <div class="toolbar">
      <div class="pill">
        <button class="btn accent" id="btnSpeakAll" aria-label="æœ—è®€æœ¬é æ¨™é¡Œ">ğŸ”Š æœ—è®€æ¨™é¡Œ</button>
        <button class="btn" id="btnVoiceCheck">ğŸ—£ï¸ èªéŸ³æª¢æŸ¥</button>
        <span class="tiny" id="voiceStatus" aria-live="polite">å»ºè­°ä½¿ç”¨æ”¯æ´ä¸­æ–‡æœ—è®€çš„è£ç½®ã€ç€è¦½å™¨</span>
      </div>
      <div class="pill">
        <span>é€²åº¦ï¼š</span>
        <span class="score" id="score">0</span>
        <span class="muted">åˆ†</span>
        <button class="btn" id="btnReset">ğŸ”„ å…¨éƒ¨é‡ç©</button>
      </div>
    </div>

    <nav class="tabs" role="tablist" aria-label="éŠæˆ²é—œå¡é¸å–®">
      <button class="tab active" data-tab="g1" role="tab" aria-controls="g1">ğŸ§  é—œå¡ä¸€</button>
      <button class="tab" data-tab="g2" role="tab" aria-controls="g2">ğŸ§© é—œå¡äºŒ</button>
      <button class="tab" data-tab="g3" role="tab" aria-controls="g3">ğŸ”— é—œå¡ä¸‰</button>
      <button class="tab" data-tab="g4" role="tab" aria-controls="g4">ğŸ“– é—œå¡å››</button>
    </nav>

    <!-- é—œå¡ä¸€ï¼šéƒ¨ä»¶çŒœå­—ï¼ˆè¦–è¦ºåŒ–é»é¸ï¼‰ -->
    <section class="panel active" id="g1" role="tabpanel" aria-labelledby="tab-g1">
      <div class="card card-g1">
        <div class="card-title">ğŸ§  é—œå¡ä¸€ï¼šéƒ¨ä»¶çŒœå­—ï¼ˆé»é¸æ­£ç¢ºçš„éƒ¨ä»¶ä¾†çµ„å­—ï¼‰</div>
        <p class="inst">1. è§€å¯Ÿç•«é¢ä¸­çš„æç¤ºï¼Œä¾‹å¦‚ï¼šã€Œå„ + ? = é§±ã€ã€‚2. å¾é¸é …ä¸­æ‰¾å‡ºæ­£ç¢ºçš„éƒ¨ä»¶ã€‚3. ç­”å°å¾—åˆ†ï¼ŒæŒ‘æˆ°ä¸‹ä¸€å€‹å­—ï¼</p>
        <div id="g1Question" class="flex-center" style="margin:20px 0;">
          <!-- ä»»å‹™æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
        </div>
        <div class="grid cols-3" id="g1Options" aria-live="polite"></div>
      </div>
    </section>

    <!-- é—œå¡äºŒï¼šå¡«å­—é€ è©ï¼ˆé»é¸æ–¹å¼ï¼‰ -->
    <section class="panel" id="g2" role="tabpanel" aria-labelledby="tab-g2">
      <div class="card card-g2">
        <div class="card-title">ğŸ§© é—œå¡äºŒï¼šå¡«å­—é€ è©ï¼ˆé»é¸æ­£ç¢ºçš„å­—å¡«å…¥ç©ºæ ¼ï¼‰</div>
        <p class="inst">1. è§€å¯Ÿé¡Œç›®ä¸­çš„è©èªã€‚2. é»é¸æ­£ç¢ºçš„å­—ä¾†å¡«å…¥ã€Œç©ºæ ¼ã€ã€‚3. å…¨éƒ¨ç­”å°å°±é€šé—œï¼</p>
        <div class="g2-grid-container">
          <!-- å·¦å´å¡«ç©ºå€ -->
          <div class="g2-board" id="g2BoardLeft"></div>
          <!-- ä¸­é–“å­—å¡å€ -->
          <div class="g2-drag-pool" id="g2Pool" aria-label="å¯é¸æ“‡çš„å­—å¡å€">
            <div class="inst" style="text-align:center;">é»é¸å­—å¡</div>
          </div>
          <!-- å³å´å¡«ç©ºå€ -->
          <div class="g2-board" id="g2BoardRight"></div>
        </div>
      </div>
    </section>

    <!-- é—œå¡ä¸‰ï¼šè©ç¾©é…å°ï¼ˆé»é¸æ–¹å¼ï¼‰ -->
    <section class="panel" id="g3" role="tabpanel" aria-labelledby="tab-g3">
      <div class="card card-g3">
        <div class="card-title">ğŸ”— é—œå¡ä¸‰ï¼šè©ç¾©é…å°ï¼ˆé»é¸è©èªå†é»å°æ‡‰è§£é‡‹ï¼‰</div>
        <p class="inst">1. è®€è§£é‡‹ã€‚2. å…ˆé»é¸ã€Œè©èªã€ï¼Œå†é»é¸å°æ‡‰çš„ã€Œè§£é‡‹ã€ã€‚3. å®Œæˆå…¨éƒ¨é…å°å°±é€šé—œã€‚</p>
        <div class="g3-grid-container">
          <div>
            <div class="inst"><strong>è«‹é»é¸çš„è©èªï¼š</strong></div>
            <div class="word-chip-container" id="g3Words"></div>
          </div>
          <div>
            <div class="inst"><strong>è§£é‡‹ï¼ˆé»é€™è£¡ï¼‰ï¼š</strong></div>
            <div class="grid" id="g3Defs" style="grid-template-columns:1fr; gap:10px;"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- é—œå¡å››ï¼šå”¸è¬ æœ—è®€ -->
    <section class="panel" id="g4" role="tabpanel" aria-labelledby="tab-g4">
      <div class="card card-g4">
        <div class="card-title">ğŸ“– é—œå¡å››ï¼šå”¸è¬ æœ—è®€ï¼ˆè·Ÿè‘—ç¯€å¥å”¸ä¸€å”¸ï¼‰</div>
        <p class="inst">1. é»ã€Œé€è¡Œæ’­æ”¾ã€è½æ¯ä¸€è¡Œã€‚2. ä¹Ÿå¯ä»¥é»é¸ä»»ä½•ä¸€è¡Œä¾†å–®ç¨æœ—è®€ã€‚3. è©¦è‘—å¤§è²è·Ÿè®€ï¼</p>
        <div class="row" style="gap:8px; margin:8px 0 12px;">
          <button class="btn primary" id="g4PlaySeq">â–¶ï¸ é€è¡Œæ’­æ”¾</button>
          <button class="btn" id="g4Stop">â¹ï¸ åœæ­¢</button>
        </div>
        <div class="g4-grid-container" id="g4Lines">
          <!-- å”¸è¬ å…§å®¹æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>
      <div class="card card-g4">
        <div class="inst"><strong>è£œå……å°çŸ¥è­˜ï¼š</strong></div>
        <div class="tags">
          <span class="tag">ã€Œå„ã€å­—æ—åœ¨çµ„åˆä¸­å¸¸ç•¶éƒ¨ä»¶ä½¿ç”¨</span>
          <span class="tag">ä¾‹ï¼šé§±ï¼ˆã„Œã„¨ã„›Ë‹ï¼‰ã€æ ¼ï¼ˆã„ã„œËŠï¼‰ã€å®¢ï¼ˆã„ã„œË‹ï¼‰</span>
          <span class="tag">ã€Œæ´›ã€è½ï¼Œç™¼éŸ³ç›¸åŒä½†æ„ç¾©ä¸åŒ</span>
        </div>
      </div>
    </section>

    <div class="footer-note">æç¤ºï¼šè‹¥æ²’è½åˆ°è²éŸ³ï¼Œè«‹å…ˆé»æ“Šé é¢ä»»æ„è™•å•Ÿç”¨éŸ³è¨Šï¼Œæˆ–é»ã€ŒèªéŸ³æª¢æŸ¥ã€ã€‚</div>
    <div class="confetti" id="confetti"></div>
  </div>

  <script>
    // ========= è³‡æ–™ =========
    const chars = [
      {han:'éª¼', bpmf:'ã„Œã„¨ã„›Ë‹', hint:'éª¨é ­çš„æ¶æ§‹', voice:'éª¼'},
      {han:'æ ¼', bpmf:'ã„ã„œËŠ', hint:'è¦æ ¼ã€å“æ ¼', voice:'æ ¼'},
      {han:'å®¢', bpmf:'ã„ã„œË‹', hint:'å®¢äºº', voice:'å®¢'},
      {han:'é–£', bpmf:'ã„ã„œËŠ', hint:'æ¨“é–£', voice:'é–£'},
      {han:'çµ¡', bpmf:'ã„Œã„¨ã„›Ë‹', hint:'è¯çµ¡ã€ç¶²çµ¡', voice:'çµ¡'},
      {han:'è³‚', bpmf:'ã„Œã„¨Ë‹', hint:'è³„è³‚', voice:'è³‚'},
      {han:'é…ª', bpmf:'ã„Œã„ Ë‹', hint:'ä¹³é…ª', voice:'é…ª'},
      {han:'æ´›', bpmf:'ã„Œã„¨ã„›Ë‹', hint:'æ´›é™½', voice:'æ´›'},
      {han:'è½', bpmf:'ã„Œã„¨ã„›Ë‹', hint:'è½ä¸‹', voice:'è½'},
      {han:'è·¯', bpmf:'ã„Œã„¨Ë‹', hint:'é“è·¯', voice:'è·¯'},
      {han:'ç•¥', bpmf:'ã„Œã„©ã„Ë‹', hint:'ç­–ç•¥', voice:'ç•¥'},
      {han:'é§±', bpmf:'ã„Œã„¨ã„›Ë‹', hint:'å‹•ç‰©åç¨±', voice:'é§±'},
    ];

    const g1Compositions = [
      {han:'é§±', parts:['å„', 'é¦¬']},
      {han:'æ ¼', parts:['å„', 'æœ¨']},
      {han:'å®¢', parts:['å„', 'å®€']},
      {han:'é–£', parts:['å„', 'é–€']},
      {han:'çµ¡', parts:['å„', 'ç³¸']},
      {han:'è³‚', parts:['å„', 'è²']},
      {han:'é…ª', parts:['å„', 'é…‰']},
      {han:'æ´›', parts:['å„', 'æ°´']},
      {han:'è½', parts:['æ´›', 'è‰¸']},
      {han:'è·¯', parts:['å„', 'è¶³']},
      {han:'ç•¥', parts:['å„', 'ç”°']},
    ];
    const commonParts = ['é¦¬', 'æœ¨', 'å®€', 'é–€', 'ç³¸', 'è²', 'é…‰', 'æ°´', 'è¶³', 'ç”°', 'å¿ƒ', 'åœŸ', 'æ‰‹', 'è‰¸', 'ç‹', 'äºº', 'å£', 'çŸ³'];

    const words = [
      {han:'éª¨éª¼', bpmf:'ã„ã„¨Ë‡ ã„ã„œËŠ', def:'èº«é«”çš„éª¨é ­æ¶æ§‹'},
      {han:'æ ¼å¼', bpmf:'ã„ã„œËŠ ã„•Ë‹', def:'å›ºå®šçš„æ¨£å¼æˆ–æ¨™æº–'},
      {han:'å®¢äºº', bpmf:'ã„ã„œË‹ ã„–ã„£ËŠ', def:'ä¾†è¨ªçš„äºº'},
      {han:'æ¨“é–£', bpmf:'ã„Œã„¡ËŠ ã„ã„œËŠ', def:'é«˜å¤§çš„å»ºç¯‰ç‰©'},
      {han:'è¯çµ¡', bpmf:'ã„Œã„§ã„¢ËŠ ã„Œã„¨ã„›Ë‹', def:'å½¼æ­¤æºé€šé€£ç¹«'},
      {han:'è³„è³‚', bpmf:'ã„ã„¨ã„ŸË‹ ã„Œã„¨Ë‹', def:'ç”¨é‡‘éŒ¢æ”¶è²·ä»–äºº'},
      {han:'ä¹³é…ª', bpmf:'ã„–ã„¨Ë‡ ã„Œã„ Ë‹', def:'ç”¨ç‰›å¥¶è£½æˆçš„é£Ÿå“'},
      {han:'æ´›é™½', bpmf:'ã„Œã„¨ã„›Ë‹ ã„§ã„¤ËŠ', def:'ä¸­åœ‹å¤éƒ½å'},
      {han:'é™·è½', bpmf:' ã„’ã„§ã„¢Ë‹ã„Œã„¨ã„›Ë‹', def:'å¾ä¸Šå¾€ä¸‹æ‰'},
      {han:'é“è·¯', bpmf:'ã„‰ã„ Ë‹ ã„Œã„¨Ë‹', def:'ä¾›äººè¡Œèµ°çš„é€šé“'},
      {han:'ç­–ç•¥', bpmf:'ã„˜ã„œË‹ ã„Œã„©ã„Ë‹', def:'é”æˆç›®æ¨™çš„è¨ˆç•«æ–¹æ³•'},
      {han:'åƒ¹æ ¼', bpmf:'ã„ã„§ã„šË‹ ã„ã„œËŠ', def:'å•†å“çš„å”®åƒ¹'},
    ];

    // ä¿®æ”¹å”¸è¬ å…§å®¹
    const rhymeLines = [
      {text:'æ´›é™½ä¸€é–“å°é–£æ¨“ï¼Œ', icon:'ğŸ›ï¸', color:'c1'},
      {text:'å®¢äººéƒ½è¦åƒä¹³é…ªï¼›', icon:'ğŸ§€', color:'c2'},
      {text:'è·¯ä¸Šé ç´„å·²æ»¿é¡ï¼Œ', icon:'ğŸ›£ï¸', color:'c3'},
      {text:'åƒ¹æ ¼å¤ªé«˜é›£è³„è³‚ï¼›', icon:'ğŸ’°', color:'c4'},
      {text:'éª¨éª¼ç²—å£¯é¨é§±é§ï¼Œ', icon:'ğŸ', color:'c1'},
      {text:'ç­–ç•¥è½å¾Œå†è¯çµ¡ï¼Œ', icon:'ğŸ“', color:'c2'},
      {text:'åƒå®Œå„å€‹ç¬‘å®¹éœ²ã€‚', icon:'ğŸ˜Š', color:'c3'},
    ];

    // ========= å…¬ç”¨ï¼šèªéŸ³ =========
    let voices = [];
    function loadVoices(){
      voices = speechSynthesis.getVoices();
      const zh = voices.filter(v => (v.lang||'').toLowerCase().startsWith('zh'));
      const status = document.getElementById('voiceStatus');
      if(zh.length){
        const tw = zh.find(v => v.lang.toLowerCase().includes('zh-tw'));
        const pick = tw || zh[0];
        status.textContent = `å·²æ‰¾åˆ°èªéŸ³ï¼š${pick.name}ï¼ˆ${pick.lang}ï¼‰`;
      }else{
        status.textContent = 'å°šæœªåµæ¸¬åˆ°ä¸­æ–‡èªéŸ³ï¼Œä»å¯å˜—è©¦æ’­æ”¾';
      }
    }
    if('speechSynthesis' in window){
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak(text, rate=0.9){
      if(!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      const zhTW = voices.find(v => v.lang && v.lang.toLowerCase().includes('zh-tw'));
      const zhAny = voices.find(v => v.lang && v.lang.toLowerCase().startsWith('zh'));
      u.voice = zhTW || zhAny || null;
      u.rate = rate;
      u.pitch = 1;
      u.volume = 1;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    // ========= å·¥å…· =========
    const rand = (n)=> Math.floor(Math.random()*n);
    const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);

    function confettiBurst(){
      const c = document.getElementById('confetti');
      const icons = ['âœ¨','ğŸŒ¸','â­','ğŸ’–','ğŸ‰','ğŸŒŸ','ğŸ§¸','ğŸˆ'];
      for(let i=0;i<16;i++){
        const s = document.createElement('span');
        s.textContent = icons[rand(icons.length)];
        s.style.left = (Math.random()*100)+'%';
        s.style.animationDelay = (Math.random()*0.4)+'s';
        c.appendChild(s);
        setTimeout(()=>s.remove(), 1700);
      }
    }

    // ========= é€²åº¦ =========
    let score = 0;
    function addScore(n=1){
      score += n;
      document.getElementById('score').textContent = score;
    }
    function resetAll(){
      score = 0; document.getElementById('score').textContent = score;
      initG1(); initG2(); initG3(); initG4();
    }

    // ========= é—œå¡ä¸€ï¼šéƒ¨ä»¶çŒœå­— =========
    let g1Answer = null;
    let g1Questions = [];
    let g1CurrentIdx = 0;

    function pickG1Question(){
      if(g1Questions.length === 0){
        // ç¢ºä¿é¡Œç›®éƒ½ä»¥ã€Œå„ã€ä½œç‚ºä¸»é¡Œå­—ï¼Œä¸”å¦ä¸€åŠæ˜¯éš¨æ©Ÿçš„
        g1Questions = shuffle([...g1Compositions]);
      }
      if(g1CurrentIdx >= g1Questions.length){
        speak('æ­å–œä½ ï¼Œå®Œæˆäº†æ‰€æœ‰çµ„å­—æŒ‘æˆ°ï¼');
        g1CurrentIdx = 0;
        g1Questions = shuffle([...g1Compositions]);
        setTimeout(pickG1Question, 2500); // å¾ªç’°æŒ‘æˆ°
        return;
      }
      
      const targetItem = g1Questions[g1CurrentIdx];
      const allParts = targetItem.parts;
      const questionBox = document.getElementById('g1Question');
      
      // è™•ç†å–®éƒ¨ä»¶çµ„åˆ
      const answerPart = allParts.find(p => p !== 'å„');
      
      questionBox.innerHTML = `
        <div class="han xl">å„</div>
        <span class="equal-sign">+</span>
        <div class="han xl">?</div>
        <span class="equal-sign">=</span>
        <div class="han xl">${targetItem.han}</div>
      `;

      const optionsSet = new Set([answerPart]);
      while(optionsSet.size < 3){
        const randPart = commonParts[rand(commonParts.length)];
        if(randPart !== 'å„' && !allParts.includes(randPart) && randPart !== answerPart){
          optionsSet.add(randPart);
        }
      }
      const options = shuffle([...optionsSet]);

      const box = document.getElementById('g1Options');
      box.innerHTML = '';
      options.forEach(p=>{
        const div = document.createElement('button');
        div.className = 'option';
        div.setAttribute('aria-label', `é¸é … ${p}`);
        div.innerHTML = `<div class="han xl">${p}</div>`;
        div.addEventListener('click', ()=>{
          if(p === answerPart){
            div.classList.add('correct');
            addScore(1);
            confettiBurst();
            speak(`å¤ªæ£’äº†ï¼ç­”æ¡ˆæ˜¯ï¼š${p}ã€‚${targetItem.han}é€™å€‹å­—å°±æ˜¯ç”± ${allParts.join('å’Œ')} çµ„æˆçš„å–”ï¼`);
            g1CurrentIdx++;
            setTimeout(pickG1Question, 3000);
          }else{
            div.classList.add('wrong');
            speak('é€™å€‹ä¸æ˜¯æ­£ç¢ºçš„éƒ¨ä»¶ï¼Œå†æƒ³æƒ³çœ‹å–”');
            setTimeout(()=> div.classList.remove('wrong'), 800);
          }
        });
        box.appendChild(div);
      });
      
      speak(`è«‹æ‰¾å‡ºé€™å€‹å­—çš„çµ„æˆéƒ¨ä»¶ï¼š${targetItem.han}`);
    }

    function initG1(){
      g1Questions = shuffle([...g1Compositions]);
      g1CurrentIdx = 0;
      pickG1Question();
    }

    // ========= é—œå¡äºŒï¼šå¡«å­—é€ è©ï¼ˆæ”¹ç‚ºé»é¸æ–¹å¼ï¼‰ =========
    const g2Items = [
      {tmpl:'å“_', ans:'æ ¼', word:'å“æ ¼', def:'å“è¡Œ'},
      {tmpl:'_äºº', ans:'å®¢', word:'å®¢äºº', def:'ä¾†è¨ªçš„äºº'},
      {tmpl:'éª¨_', ans:'éª¼', word:'éª¨éª¼', def:'èº«é«”çš„éª¨é ­æ¶æ§‹'},
      {tmpl:'æ¨“_', ans:'é–£', word:'æ¨“é–£', def:'é«˜å¤§çš„å»ºç¯‰ç‰©'},
      {tmpl:'è¯_', ans:'çµ¡', word:'è¯çµ¡', def:'å½¼æ­¤æºé€šé€£ç¹«'},
      {tmpl:'è³„_', ans:'è³‚', word:'è³„è³‚', def:'ç”¨é‡‘éŒ¢æ”¶è²·ä»–äºº'},
      {tmpl:'ä¹³_', ans:'é…ª', word:'ä¹³é…ª', def:'ç”¨ç‰›å¥¶è£½æˆçš„é£Ÿå“'},
      {tmpl:'_é™½', ans:'æ´›', word:'æ´›é™½', def:'ä¸­åœ‹å¤éƒ½å'},
      {tmpl:'é™·_', ans:'è½', word:'é™·è½', def:'å¾ä¸Šå¾€ä¸‹æ‰'},
      {tmpl:'é“_', ans:'è·¯', word:'é“è·¯', def:'ä¾›äººè¡Œèµ°çš„é€šé“'},
      {tmpl:'ç­–_', ans:'ç•¥', word:'ç­–ç•¥', def:'é”æˆç›®æ¨™çš„è¨ˆç•«æ–¹æ³•'},
      {tmpl:'_é§', ans:'é§±', word:'é§±é§', def:'å‹•ç‰©'},
    ];

    let g2SelectedChar = null;
    let g2CompletedItems = new Set();

    function initG2(){
      const boardLeft = document.getElementById('g2BoardLeft');
      const boardRight = document.getElementById('g2BoardRight');
      const pool = document.getElementById('g2Pool');
      boardLeft.innerHTML = '';
      boardRight.innerHTML = '';
      pool.innerHTML = '<div class="inst" style="text-align:center;">é»é¸å­—å¡</div>';
      g2SelectedChar = null;
      g2CompletedItems.clear();
      
      const useItems = shuffle(g2Items);
      const leftItems = useItems.slice(0, 5);
      const rightItems = useItems.slice(5, 11);

      // ç”¢ç”Ÿå·¦å´å¡«ç©ºå€
      leftItems.forEach(it => {
        const card = document.createElement('div');
        card.className='g2-board-card';
        const tmplParts = it.tmpl.split('_');
        const cardHtml = `
          <div class="row">
            ${tmplParts.map((p,i) => {
              let partHtml = `<div class="big">${p}</div>`;
              if (i < tmplParts.length - 1) { // åŠ ä¸Šç©ºä½
                partHtml += `<div class="dropzone" data-ans="${it.ans}" data-word="${it.word}" aria-label="å¡«å­—ç©ºæ ¼" tabindex="0">_</div>`;
              }
              return partHtml;
            }).join('')}
          </div>
          <div class="hint-text">æç¤ºï¼š${it.def}</div>
        `;
        card.innerHTML = cardHtml;
        boardLeft.appendChild(card);
      });
      
      // ç”¢ç”Ÿå³å´å¡«ç©ºå€
      rightItems.forEach(it => {
        const card = document.createElement('div');
        card.className='g2-board-card';
        const tmplParts = it.tmpl.split('_');
        const cardHtml = `
          <div class="row">
            ${tmplParts.map((p,i) => {
              let partHtml = `<div class="big">${p}</div>`;
              if (i < tmplParts.length - 1) { // åŠ ä¸Šç©ºä½
                partHtml += `<div class="dropzone" data-ans="${it.ans}" data-word="${it.word}" aria-label="å¡«å­—ç©ºæ ¼" tabindex="0">_</div>`;
              }
              return partHtml;
            }).join('')}
          </div>
          <div class="hint-text">æç¤ºï¼š${it.def}</div>
        `;
        card.innerHTML = cardHtml;
        boardRight.appendChild(card);
      });

      // ç”¢ç”Ÿå­—å¡
      const allChars = shuffle(chars.map(c=>c.han));
      allChars.forEach(h=>{
        const d = document.createElement('div');
        d.className='draggable';
        d.textContent = h;
        d.setAttribute('data-char', h);
        d.addEventListener('click', ()=> {
          // æ¸…é™¤ä¹‹å‰é¸æ“‡çš„å­—å¡
          document.querySelectorAll('.g2-drag-pool .draggable').forEach(el => el.classList.remove('selected'));
          // æ¨™è¨˜ç•¶å‰é¸æ“‡
          d.classList.add('selected');
          g2SelectedChar = h;
        });
        pool.appendChild(d);
      });

      // ç‚ºç©ºæ ¼æ·»åŠ é»é¸äº‹ä»¶
      document.querySelectorAll('#g2BoardLeft .dropzone, #g2BoardRight .dropzone').forEach(z=>{
        z.addEventListener('click', ()=>{
          if(!g2SelectedChar) {
            speak('è«‹å…ˆé»é¸ä¸€å€‹å­—å¡');
            return;
          }
          
          const ans = z.dataset.ans;
          const word = z.dataset.word;
          
          if(g2CompletedItems.has(ans)) return; // å·²å®Œæˆçš„é …ç›®ä¸å†è™•ç†
          
          if(!z.textContent || z.textContent==='_'){
            z.textContent = g2SelectedChar;
          }
          
          if(g2SelectedChar === ans){
            z.classList.remove('no'); 
            z.classList.add('ok');
            addScore(1);
            confettiBurst();
            speak(`å¤ªæ£’äº†ï¼å®Œæˆï¼š${word}`);
            
            g2CompletedItems.add(ans);
            
            // ç§»é™¤å·²ä½¿ç”¨çš„å­—å¡
            const usedCard = [...pool.children].find(c => c.getAttribute('data-char') === g2SelectedChar);
            if(usedCard) {
              usedCard.style.transition = 'all 0.3s ease';
              usedCard.style.opacity = '0';
              usedCard.style.transform = 'scale(0.8)';
              setTimeout(() => usedCard.remove(), 300);
            }
            
            g2SelectedChar = null;
            document.querySelectorAll('.g2-drag-pool .draggable').forEach(el => el.classList.remove('selected'));
          } else {
            z.classList.remove('ok'); 
            z.classList.add('no');
            speak('å†è©¦ä¸€æ¬¡');
            setTimeout(()=> {
              z.classList.remove('no');
              z.textContent = '_';
            }, 1000);
          }
        });
        
        z.addEventListener('mouseenter', ()=> {
          if(g2SelectedChar && !g2CompletedItems.has(z.dataset.ans)) {
            z.classList.add('highlighted');
          }
        });
        
        z.addEventListener('mouseleave', ()=> {
          z.classList.remove('highlighted');
        });
      });
    }

    // ========= é—œå¡ä¸‰ï¼šè©ç¾©é…å°ï¼ˆæ”¹ç‚ºé»é¸æ–¹å¼ï¼‰ =========
    let g3CompletedPairs = new Set();
    let g3SelectedWord = null;

    function initG3(){
      const pool = document.getElementById('g3Words');
      const defs = document.getElementById('g3Defs');
      pool.innerHTML=''; 
      defs.innerHTML='';
      g3CompletedPairs.clear();
      g3SelectedWord = null;
      
      const use = shuffle(words.slice(0));
      
      // å‰µå»ºè©èªå¡ç‰‡
      use.forEach(w=>{
        const chip = document.createElement('div');
        chip.className='word-chip';
        chip.textContent = w.han;
        chip.setAttribute('data-word', w.han);
        chip.addEventListener('click', () => {
          if(g3CompletedPairs.has(w.han)) return; // å·²å®Œæˆçš„è©èªä¸èƒ½å†é¸
          
          // æ¸…é™¤ä¹‹å‰é¸æ“‡
          document.querySelectorAll('.word-chip').forEach(c => c.classList.remove('selected'));
          // æ¨™è¨˜ç•¶å‰é¸æ“‡
          chip.classList.add('selected');
          g3SelectedWord = w.han;
          speak(`å·²é¸æ“‡ï¼š${w.han}`);
        });
        pool.appendChild(chip);
      });
      
      // å‰µå»ºè§£é‡‹å€åŸŸ
      shuffle(use).forEach((w, index)=>{
        const box = document.createElement('div');
        box.className='line dropzone';
        box.setAttribute('data-ans', w.han);
        box.setAttribute('data-index', index);
        box.innerHTML = `<div><strong>${w.def}</strong></div><div class="muted">${w.bpmf}</div>`;
        
        box.addEventListener('click', () => {
          if(!g3SelectedWord) {
            speak('è«‹å…ˆé»é¸ä¸€å€‹è©èª');
            return;
          }
          
          if(g3CompletedPairs.has(w.han)) return; // å·²å®Œæˆçš„é…å°ä¸å†è™•ç†
          
          if(g3SelectedWord === w.han){
            box.classList.add('ok');
            box.innerHTML = `${w.han}ï¼ˆ${w.bpmf}ï¼‰ï¼š${w.def}`;
            addScore(1);
            confettiBurst();
            speak(`${w.han}ï¼Œ${w.bpmf}ã€‚${w.def}`);
            
            // æ¨™è¨˜ç‚ºå·²å®Œæˆ
            g3CompletedPairs.add(w.han);
            
            // ç§»é™¤å°æ‡‰çš„è©èªå¡ç‰‡
            const chip = [...pool.children].find(c=>c.getAttribute('data-word')===w.han);
            if(chip) {
              chip.style.transition = 'all 0.3s ease';
              chip.style.opacity = '0';
              chip.style.transform = 'scale(0.8)';
              setTimeout(() => {
                chip.remove();
                reorganizeWordChips();
              }, 300);
            }
            
            // ç§»é™¤å·²å®Œæˆçš„è§£é‡‹æ¡†ä¸¦é‡æ–°æ•´ç†
            setTimeout(() => {
              box.style.transition = 'all 0.3s ease';
              box.style.opacity = '0';
              box.style.transform = 'translateY(-10px)';
              setTimeout(() => {
                box.remove();
                reorganizeDefinitions();
              }, 300);
            }, 1000);
            
            g3SelectedWord = null;
            document.querySelectorAll('.word-chip').forEach(c => c.classList.remove('selected'));
            
          } else {
            box.classList.add('no');
            speak('é€™å€‹è§£é‡‹ä¸å¤ªå°ï¼Œå†æƒ³æƒ³');
            setTimeout(()=>box.classList.remove('no'), 600);
          }
        });
        
        box.addEventListener('mouseenter', ()=> {
          if(g3SelectedWord && !g3CompletedPairs.has(w.han)) {
            box.classList.add('highlighted');
          }
        });
        
        box.addEventListener('mouseleave', ()=> {
          box.classList.remove('highlighted');
        });
        
        defs.appendChild(box);
      });
    }

    // é‡æ–°æ•´ç†è©èªå¡ç‰‡æ’åˆ—
    function reorganizeWordChips(){
      const pool = document.getElementById('g3Words');
      const chips = [...pool.children];
      chips.forEach((chip, index) => {
        chip.style.transition = 'all 0.3s ease';
        chip.style.transform = 'translateY(0)';
      });
    }

    // é‡æ–°æ•´ç†è§£é‡‹å€åŸŸæ’åˆ—
    function reorganizeDefinitions(){
      const defs = document.getElementById('g3Defs');
      const boxes = [...defs.children];
      boxes.forEach((box, index) => {
        box.style.transition = 'all 0.3s ease';
        box.style.transform = 'translateY(0)';
      });
    }

    // ========= é—œå¡å››ï¼šå”¸è¬ æœ—è®€ =========
    let g4Playing = false;
    function initG4(){
      const wrap = document.getElementById('g4Lines');
      wrap.innerHTML = '';

      // å»ºç«‹å…©å€‹å­å®¹å™¨ï¼Œåˆ†åˆ¥æ”¾å‰å››å¥å’Œå¾Œä¸‰å¥
      const col1 = document.createElement('div');
      const col2 = document.createElement('div');
      wrap.appendChild(col1);
      wrap.appendChild(col2);

      rhymeLines.forEach((t,i)=>{
        const line = document.createElement('div');
        line.className=`g4-line ${t.color}`;
        line.textContent = t.text;
        line.tabIndex=0;

        const iconSpan = document.createElement('span');
        iconSpan.className='g4-line-icon';
        iconSpan.textContent = t.icon;
        line.prepend(iconSpan);

        line.addEventListener('click', ()=>{
          highlightLine(i);
          speak(t.text, 0.95);
        });
        if (i < 4) {
          col1.appendChild(line);
        } else {
          col2.appendChild(line);
        }
      });

      document.getElementById('g4PlaySeq').onclick = async ()=>{
        g4Playing = true;
        for(let i=0;i<rhymeLines.length && g4Playing;i++){
          highlightLine(i);
          speak(rhymeLines[i].text, 0.95);
          // Wait for a little longer, to give user time to repeat
          await waitSpeakEnd(1200 + rhymeLines[i].text.length*80);
        }
        if(g4Playing){
          addScore(2);
          confettiBurst();
          speak('æœ—è®€å®Œæˆï¼Œå¤ªæ£’äº†ï¼');
        }
        g4Playing = false;
        highlightLine(-1);
      };
      document.getElementById('g4Stop').onclick = ()=>{
        g4Playing = false;
        window.speechSynthesis.cancel();
        highlightLine(-1);
      };
    }
    function highlightLine(idx){
      [...document.querySelectorAll('#g4Lines .g4-line')].forEach((n,i)=>{
        n.classList.toggle('active', i===idx);
      });
    }
    function waitSpeakEnd(ms){
      return new Promise(res=> setTimeout(res, ms));
    }

    // ========= å°è¦½ =========
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.tab;
        document.querySelectorAll('.panel').forEach(p=>{
          p.classList.toggle('active', p.id===id);
        });
      });
    });

    // ========= é é¢æ§åˆ¶ =========
    document.getElementById('btnReset').onclick = resetAll;
    document.getElementById('btnSpeakAll').onclick = ()=> speak('èŠ¸è¾¦å­—ã€Œå„ã€å­—æ—ï¼Œå°å°æ–‡å­—æ¢éšªï¼Œæº–å‚™é–‹å§‹ï¼');
    document.getElementById('btnVoiceCheck').onclick = ()=>{
      loadVoices();
      speak('èªéŸ³æ¸¬è©¦ã€‚ä½ å¥½ï¼Œæˆ‘å€‘ä¸€èµ·å­¸ç¿’ã€Œå„ã€å­—æ—ã€‚');
    };

    // åˆå§‹åŒ–
    initG1(); initG2(); initG3(); initG4();
  </script>
</body>
</html>